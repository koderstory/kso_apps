<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data>
    <!-- product.template form header -->
    <record id="product_template_form_inherit" model="ir.ui.view">
      <field name="name">kso.product.template.form.approval</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="product.product_template_only_form_view" />
      <field name="arch" type="xml">
        <xpath expr="//header" position="inside">

          <!-- Draft → Sourcing -->
          <button name="action_source"
            string="Send to Sourcing"
            type="object"
            class="btn-secondary"
            groups="kso_product_approval.group_product_sourcing"
            invisible="state!='draft'" />

          <!-- Sourcing → Approved -->
          <button name="action_verify"
            string="Approve"
            type="object"
            class="btn-primary"
            groups="kso_product_approval.group_product_approval"
            invisible="state!='sourcing'" />

          <!-- Reset to Draft -->
          <button name="action_draft"
            string="Set to Draft"
            type="object"
            class="btn-tertiary"
            groups="kso_product_approval.group_product_approval,kso_product_approval.group_product_sourcing"
            invisible="state=='draft'" />

          <field name="state" widget="statusbar" />

        </xpath>
      </field>
    </record>

    <!-- product.product form header -->
    <record id="product_product_form_inherit" model="ir.ui.view">
      <field name="name">kso.product.product.form.approval</field>
      <field name="model">product.product</field>
      <field name="inherit_id" ref="product.product_normal_form_view" />
      <field name="arch" type="xml">
        <xpath expr="//header" position="inside">

          <button name="action_source"
            string="Send to Sourcing"
            type="object"
            class="btn-primary"
            groups="kso_product_approval.group_product_sourcing"
            invisible="state!='draft'" />

          <button name="action_verify"
            string="Approve"
            type="object"
            class="btn-primary"
            groups="kso_product_approval.group_product_approval"
            invisible="state!='sourcing'" />

          <button name="action_draft"
            string="Set to Draft"
            type="object"
            class="btn-tertiary"
            groups="kso_product_approval.group_product_approval,kso_product_approval.group_product_sourcing"
            invisible="state=='draft'" />

          <field name="state" widget="statusbar" />

        </xpath>
      </field>
    </record>

    <!-- Tree Views -->
    <record id="product_template_tree_inherit" model="ir.ui.view">
      <field name="name">kso.product.template.tree.approval</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="product.product_template_tree_view" />
      <field name="arch" type="xml">
        <xpath expr="//field[@name='uom_id']" position="after">
          <button name="action_verify" string="Approve" type="object"
            invisible="state=='approved'"
            class="btn-secondary"
            groups="kso_product_approval.group_product_approval" />
          <field name="state" widget="badge"
            decoration-danger="state=='draft'"
            decoration-success="state=='approved'" />
        </xpath>
      </field>
    </record>

    <record id="product_product_tree_inherit" model="ir.ui.view">
      <field name="name">kso.product.product.tree.approval</field>
      <field name="model">product.product</field>
      <field name="inherit_id" ref="product.product_product_tree_view" />
      <field name="arch" type="xml">
        <xpath expr="//field[@name='virtual_available']" position="after">
          <button name="action_verify" string="Approve" type="object"
            invisible="state=='approved'"
            groups="kso_product_approval.group_product_approval" />
          <field name="state" widget="badge"
            decoration-danger="state=='draft'"
            decoration-success="state=='approved'" />
        </xpath>
      </field>
    </record>
  </data>
</odoo>