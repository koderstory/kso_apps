<odoo>
  <data>

    <!-- Inherit the main Sales Order form -->
    <record id="view_order_form_inherit_proforma" model="ir.ui.view">
      <field name="name">sale.order.form.proforma.inherit</field>
      <field name="model">sale.order</field>
      <field name="inherit_id" ref="sale.view_order_form" />
      <field name="priority" eval="25" />
      <field name="arch" type="xml">

        <!-- Add shiping type field -->
        <xpath expr="//field[@name='partner_id']" position="after">
          <field name="shipping_type"
            widget="radio"
            options="{'horizontal': true}"
            class="o_inline"
          />
        </xpath>

        <!-- REMOVE the Send by Email button completely -->
        <xpath expr="//button[@name='action_quotation_send']" position="replace" />

        <!-- Extend the statusbar by targeting the <field name="state"> in the header -->
        <xpath expr="//header/field[@name='state']" position="attributes">
          <attribute name="statusbar_visible">
            draft,proforma,sale
          </attribute>
        </xpath>

        <!-- Add a "Pro Forma Invoice" button that only shows when state = 'sent' -->
        <xpath expr="//header" position="inside">
          <button name="action_proforma"
            string="Pro Forma Invoice"
            type="object"
            class="oe_highlight"
            invisible="state != 'draft'" />
        </xpath>

        <!-- Allow “Cancel” in proforma stage -->
        <xpath expr="//header/button[@name='action_cancel']" position="attributes">
          <attribute name="invisible">
            state not in ('draft','sent','proforma','sale')
          </attribute>
        </xpath>

        <!-- Show Confirm in both sent & proforma -->
        <xpath expr="//header/button[@name='action_confirm']" position="attributes">
          <attribute name="invisible">
            state not in ('sent','proforma')
          </attribute>
        </xpath>

        <!-- (Optionally) re‑insert any other buttons you want in proforma -->
        <!-- e.g. the “Send PRO‑FORMA Invoice” primary button -->
        <xpath expr="//header/button[@id='send_proforma']" position="attributes">
          <attribute name="invisible">
            state not in ('draft','proforma')
          </attribute>
        </xpath>

        <!-- locate the shipping_type field and insert your codes right after -->
        <!-- Insert your codes right after the order_details group -->
        <xpath expr="//group[@name='order_details']" position="after">
          <group string="Stage Codes" colspan="2">
            <field name="code_quotation" readonly="1" />
            <field name="code_pi" readonly="1" />
            <field name="code_salesorder" readonly="1" />
          </group>
        </xpath>

       
      </field>
    </record>

  </data>
</odoo>