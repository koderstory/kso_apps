<?xml version="1.0" encoding="utf-8"?>
<odoo>
  <data noupdate="1">

    <!-- PRODUCT TEMPLATE (form): add header button + keep readonly + label = SKU -->
    <record id="kso_view_product_template_form_inherit" model="ir.ui.view">
      <field name="name">kso.product.template.form.inherit.sku.button</field>
      <field name="model">product.template</field>
      <field name="inherit_id" ref="product.product_template_only_form_view"/>
      <field name="arch" type="xml">

        <!-- Header button -->
        <xpath expr="//form/header" position="inside">
          <button name="action_generate_sku"
                  type="object"
                  string="Generate SKU"
                  help="Generate SKU for this product (and its variants)."
                  invisible="not categ_id"/>
        </xpath>

        <!-- Make Internal Reference readonly + show label SKU -->
        <field name="default_code" position="attributes">
          <attribute name="string">SKU</attribute>
          <attribute name="readonly">1</attribute>
        </field>

      </field>
    </record>

    <!-- PRODUCT VARIANT (form): add header button + keep readonly + label = SKU -->
    <record id="kso_product_product_form_inherit" model="ir.ui.view">
      <field name="name">kso.product.product.form.inherit.sku.button</field>
      <field name="model">product.product</field>
      <field name="inherit_id" ref="product.product_normal_form_view"/>
      <field name="arch" type="xml">

        <xpath expr="//form/header" position="inside">
          <button name="action_generate_sku"
                  type="object"
                  string="Generate SKU"
                  help="Generate SKU for this variant."/>
        </xpath>

        <!-- label + readonly -->
        <field name="default_code" position="attributes">
          <attribute name="string">SKU</attribute>
          <attribute name="readonly">1</attribute>
        </field>

      </field>
    </record>

  </data>
</odoo>
